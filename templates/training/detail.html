{% extends "base.html" %}
{% block title %}{{ module.title }}{% endblock %}
{% block content %}

<p class="mb-2">
  {% if return_to %}
    <a href="{{ return_to }}" class="btn">&larr; Back</a>
  {% else %}
    <a href="{% url 'training:list' %}" class="btn">&larr; Back to Training</a>
  {% endif %}
</p>
{# Back button: returns to Scenario if next= is provided; else back to Training list #}


<h1>{{ module.title }}</h1>
<div>{{ module.description|linebreaks }}</div>

{% if has_access %}
  <p><strong>You own this module.</strong></p>
{% else %}
  <p><em>Preview only. Purchase to unlock all lessons.</em></p>
  <p>Price: Â£{{ module.price_cents|floatformat:0|add:""|slice:":-2" }}.{{ module.price_cents|stringformat:"02d"|slice:"-2:" }}</p>
  <form method="post" action="{% url 'training:buy' module.pk %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-primary">Buy with Stripe</button>
  </form>
{% endif %}

<h2>Lessons</h2>
<ol>
  {% for lesson in lessons %}
    <li>
      <strong>{{ lesson.title }}</strong><br>
      {% if lesson.description %}
        <button type="button"
                class="lesson-toggle btn btn-sm btn-outline-secondary"
                data-target="lesson-desc-{{ lesson.id }}">
          Show/Hide Description
        </button>
        <div id="lesson-desc-{{ lesson.id }}" class="hidden mt-2">
          <p>{{ lesson.description }}</p>
        </div>
      {% else %}
        <em>No description.</em>
      {% endif %}
    </li>
  {% empty %}
    <li>No lessons available.</li>
  {% endfor %}
</ol>

{% endblock %}
